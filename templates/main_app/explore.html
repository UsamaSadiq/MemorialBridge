{% extends 'base.html' %}
{% load static %}

{% block title %}Explore Memorials - MemorialBridge{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="fw-bold text-primary mb-3">Explore Memorials</h1>
            <p class="text-muted">Discover and honor the lives of remarkable individuals</p>
        </div>
    </div>

    <!-- Enhanced Search Section -->
    <div class="search-section bg-white shadow-sm rounded-lg p-4 mb-4">
        <form method="get" id="searchForm">
            <div class="row g-3">
                <!-- Search Input -->
                <div class="col-lg-8">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" 
                               name="search" 
                               class="form-control form-control-lg" 
                               placeholder="Search memorials by name, story, or keyword..." 
                               value="{{ search_query }}"
                               id="searchInput"
                               autocomplete="off">
                        <button type="button" 
                                class="btn-clear {% if not search_query %}d-none{% endif %}"
                                id="clearSearch">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Search Button & Create -->
                <div class="col-lg-4 d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1">
                        <i class="fas fa-search me-1"></i>Search
                    </button>
                    {% if user.is_authenticated and user.userprofile.verified %}
                    <a href="{% url 'create_memorial' %}" class="btn btn-accent">
                        <i class="fas fa-plus me-1"></i>Create
                    </a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>

    <!-- Search Results Info -->
    {% if search_query %}
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-info d-flex justify-content-between align-items-center">
                <span>
                    <i class="fas fa-search me-2"></i>
                    Showing results for "<strong>{{ search_query }}</strong>" - <strong>{{ memorials.count }}</strong> memorial{{ memorials.count|pluralize }} found
                </span>
                <a href="{% url 'explore' %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-times me-1"></i>Clear Search
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Results Count -->
    <div class="results-info d-flex justify-content-between align-items-center mb-4">
        <div>
            <span class="text-muted">Showing <strong>{{ memorials.count }}</strong> memorial{{ memorials.count|pluralize }}</span>
        </div>
    </div>
    {% endif %}

    <!-- Memorials Grid -->
    <div class="row memorials-grid" id="memorialsGrid">
        {% for memorial in memorials %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="memorial-card-wrapper">
                <div class="memorial-card">
                    <!-- Image Container with Overlay -->
                    <div class="memorial-card-image-container">
                        {% if memorial.cover_image %}
                        <img src="{{ memorial.cover_image.url }}" 
                             class="memorial-card-image" 
                             alt="{{ memorial.name }}"
                             loading="lazy">
                        {% else %}
                        <div class="memorial-card-placeholder">
                            <i class="fas fa-user fa-3x"></i>
                        </div>
                        {% endif %}
                        
                        <!-- Overlay with Quick Actions -->
                        <div class="memorial-card-overlay">
                            <a href="{% url 'memorial_detail' memorial.slug %}" 
                               class="btn btn-light btn-sm">
                                <i class="fas fa-eye me-1"></i>View Memorial
                            </a>
                        </div>
                        
                        <!-- Status Badge -->
                        <div class="memorial-badge">
                            <span class="badge bg-success">
                                <i class="fas fa-globe me-1"></i>Public
                            </span>
                        </div>
                    </div>
                    
                    <!-- Card Content -->
                    <div class="memorial-card-body">
                        <!-- Header -->
                        <div class="memorial-card-header">
                            <h5 class="memorial-card-title">
                                <a href="{% url 'memorial_detail' memorial.slug %}">
                                    {{ memorial.name }}
                                </a>
                            </h5>
                            
                            {% if memorial.dob and memorial.dod %}
                            <div class="memorial-card-dates">
                                <i class="fas fa-calendar-alt me-1"></i>
                                <span>{{ memorial.dob|date:"Y" }} - {{ memorial.dod|date:"Y" }}</span>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Bio Preview -->
                        <p class="memorial-card-bio">
                            {{ memorial.bio|truncatewords:20|default:"A beloved individual remembered by many." }}
                        </p>
                        
                        <!-- Stats Row -->
                        <div class="memorial-card-stats">
                            <div class="stat-item">
                                <i class="fas fa-heart text-danger"></i>
                                <span>{{ memorial.donations_count }}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-tree text-success"></i>
                                <span>{{ memorial.trees_planted_count }}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-comment text-info"></i>
                                <span>{{ memorial.memories.count }}</span>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="memorial-card-footer">
                            <div class="memorial-owner">
                                <div class="owner-avatar">
                                    {{ memorial.owner.user.username|first|upper }}
                                </div>
                                <span class="owner-name">{{ memorial.owner.user.username }}</span>
                            </div>
                            
                            <a href="{% url 'memorial_detail' memorial.slug %}" 
                               class="btn btn-primary btn-sm">
                                View <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="empty-state text-center py-5">
                {% if search_query %}
                <i class="fas fa-search fa-4x text-muted mb-3 d-block"></i>
                <h3 class="text-muted mb-3">No memorials found</h3>
                <p class="text-muted">Try searching with different keywords or <a href="{% url 'explore' %}">browse all memorials</a>.</p>
                {% else %}
                <i class="fas fa-heart fa-4x text-muted mb-3 d-block"></i>
                <h3 class="text-muted mb-3">No memorials yet</h3>
                <p class="text-muted mb-4">Be the first to create a memorial and honor someone special.</p>
                {% if user.is_authenticated and user.userprofile.verified %}
                <a href="{% url 'create_memorial' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus me-2"></i>Create Memorial
                </a>
                {% else %}
                <a href="{% url 'signup' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-user-plus me-2"></i>Sign Up to Create
                </a>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
